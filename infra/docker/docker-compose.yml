version: '3.8'

services:
  # Go API Gateway
  gateway:
    build:
      context: ../..
      dockerfile: infra/docker/Dockerfile.go
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - PYTHON_SERVICE_ADDR=python:50051
      - JWT_SECRET=${JWT_SECRET}
      - ENVIRONMENT=development
    depends_on:
      - python
    networks:
      - neuronai-network

  # Python AI Service
  python:
    build:
      context: ../..
      dockerfile: infra/docker/Dockerfile.python
    ports:
      - "50051:50051"
    environment:
      - SERVICE_PORT=50051
      - JWT_SECRET=${JWT_SECRET}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    networks:
      - neuronai-network

  # Supabase (optional - for local development)
  # Uncomment if you want to run Supabase locally
  # supabase:
  #   image: supabase/supabase-local:latest
  #   ports:
  #     - "5432:5432"
  #     - "8000:8000"
  #   environment:
  #     - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
  #   networks:
  #     - neuronai-network

networks:
  neuronai-network:
    driver: bridge
